# 立体声转5.1/7.1声道混音工具

## 简介

立体声转5.1声道&7.1声道混音工具是一个专为音频爱好者和专业人士设计的应用程序，可以将普通的立体声（2.0）音频文件转换为家庭影院级别的5.1或7.1环绕声音频。该工具使用先进的音频分离技术，将原始音频分解为不同的声音组件（人声、低音、鼓声和其他声音），然后重新混合为多声道环绕声格式。

由陈缘科技开发的这款工具（v2.0）提供了简单直观的界面，支持批量处理音频文件，让您轻松享受沉浸式的音频体验。

## 功能特点

- **双模式转换**：支持将立体声音频转换为5.1或7.1环绕声格式
- **智能音频分离**：使用demucs技术将音频分离为人声、低音、鼓声和其他声音
- **高质量输出**：输出为高保真FLAC格式，保持音频质量
- **GPU/CPU处理**：支持GPU加速（推荐3GB以上显存）或CPU处理模式
- **批量处理**：支持一次性处理多个音频文件
- **智能跳过**：自动检测已处理的文件，避免重复工作

## 系统要求

- Windows操作系统
- Python 3.12（已包含在整合包中）
- 如使用GPU模式，需要NVIDIA显卡且显存≥3GB
- 足够的磁盘空间用于处理音频文件

## 安装说明

本程序为整合包形式，已包含所有必要的依赖项和Python环境，无需额外安装。

**注意：** 本整合包不需要执行envInstall.bat文件，所有依赖已预先安装。

## 使用方法

1. 确保已安装所有依赖项（详见“依赖项”部分）。
2. 下载模型文件：
   - 请从以下链接下载 `logic_roformer.pt` 模型文件：
     - [点击下载 logic_roformer.pt](https://huggingface.co/ChenTechnology/logic_bsroformer/resolve/main/logic_roformer.pt)
   - 将下载的文件放置到项目目录中的 `logic_bsroformer/models/` 文件夹中。
3. 运行程序：
   - 双击 `start.bat` 启动程序。
   - 根据提示选择处理模式（GPU 或 CPU）和混音模式（2 TO 5.1 或 2 TO 7.1）。

## 输出文件

程序将在输出目录中生成以下文件：
- 对于5.1声道转换：`原文件名_5.1.flac`
- 对于7.1声道转换：`原文件名_7.1.flac`

## 主程序说明

`main.py` 是本工具的核心程序，负责以下功能：

1. **音频分离**：
   - 使用 `separate_audio` 函数调用深度学习模型（demucs），将输入音频分离为人声、贝斯、鼓点、吉他等独立音轨。
   - 支持 GPU 加速处理（推荐显存≥3GB），或使用 CPU 模式。

2. **声道混音**：
   - 使用 `remix_channels` 函数将分离出的音轨重新混合为 5.1 或 7.1 声道格式。
   - 5.1 声道映射：左前、右前、中置、低音、左后、右后。
   - 7.1 声道映射：左前、右前、中置、低音、左后、右后、左后环绕、右后环绕。

3. **用户交互**：
   - 用户可以选择处理模式（GPU/CPU）和混音模式（2 TO 5.1 或 2 TO 7.1）。
   - 使用 GUI 文件对话框选择输入和输出目录。
   - 支持批量处理音频文件，跳过已处理的文件。

4. **进度显示**：
   - 提供进度条显示混音过程的实时进度。

5. **清理机制**：
   - 自动清理临时文件和分离后的音频文件，确保磁盘空间高效利用。

## 技术原理

本工具使用以下技术实现音频转换：

1. **音频分离**：
   - 使用 `bs_roformer` 深度学习模型（位于 `logic_bsroformer/models/logic_roformer.pt`），将立体声音频分离为人声、贝斯、鼓声和其他声音。
   - 配置文件路径：`logic_bsroformer/configs/logic_pro_config_v1.yaml`。
   - 支持 GPU 加速处理（推荐显存≥3GB），或使用 CPU 模式（通过 `--force_cpu` 参数切换）。

2. **声道映射**：
   - 5.1 声道映射：左前、右前、中置、低音、左后、右后。
   - 7.1 声道映射：左前、右前、中置、低音、左后、右后、左后环绕、右后环绕。

3. **音频重混**：
   - 将分离的音轨重新组合为多声道音频。
   - 输出为高质量 FLAC 格式，保持无损音质。

## 技术细节

- **音频分离**：
  - 使用 `bs_roformer` 模型将音频分解为多个独立音轨。
  - 配置文件路径：`logic_bsroformer/configs/logic_pro_config_v1.yaml`。
  - 模型检查点路径：`logic_bsroformer/models/logic_roformer.pt`。

- **声道混音**：
  - 使用 `pydub` 库将分离的音轨重新组合为多声道音频。
  - 输出为高质量 FLAC 格式，保持无损音质。

## 依赖项

以下是本项目实际使用的依赖项列表（来自 requirements.txt）：

- **音频处理**：
  - `pydub`
  - `ffmpeg`
  - `librosa`
  - `audiomentations`
  - `pedalboard`

- **深度学习框架**：
  - `torch==2.8.0+cu129`
  - `torchvision==0.23.0+cu129`
  - `torchaudio==2.8.0+cu129`

- **工具库**：
  - `matplotlib`（可视化工具）
  - `tqdm`（进度条工具）
  - `einops`（张量操作工具）
  - `omegaconf`（配置管理工具）

- **其他依赖**：
  - `auraloss`
  - `ml_collections`
  - `torch_log_wmse`
  - `loralib`
  - `beartype`
  - `rotary_embedding_torch`
  - `sageattention`

- **自定义模型和工具**：
  - 自定义模型位于 `logic_bsroformer/models/` 目录下。

## 常见问题

**Q: 程序运行时出现错误怎么办？**  
A: 如果程序运行出错，请查看控制台输出的错误信息，通常会提供有用的诊断信息。

**Q: 处理大文件时程序很慢怎么办？**  
A: 音频分离是计算密集型任务，大文件处理需要时间。建议使用GPU模式加速处理，或者将大文件分割成小段处理。

**Q: 为什么选择FLAC格式输出？**  
A: FLAC是无损压缩格式，可以保持原始音频质量的同时减小文件大小，

## 版权信息

立体声转5.1声道&7.1声道混音工具 v2.0 by 陈缘科技

---

如有任何问题或建议，请联系开发者。